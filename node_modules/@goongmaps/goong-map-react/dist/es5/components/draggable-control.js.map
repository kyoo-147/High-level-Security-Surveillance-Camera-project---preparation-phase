{"version":3,"file":"draggable-control.js","names":["draggableControlPropTypes","Object","assign","mapControlPropTypes","draggable","PropTypes","bool","onDrag","func","onDragEnd","onDragStart","offsetLeft","number","offsetTop","draggableControlDefaultProps","mapControlDefaultProps","getDragEventPosition","event","offsetCenter","x","y","getDragEventOffset","container","center","rect","getBoundingClientRect","left","top","getDragLngLat","dragPos","dragOffset","props","context","viewport","unproject","callbacks","state","containerRef","stopPropagation","current","setDragPos","setDragOffset","callbackEvent","lngLat","onDragCancel","registerEvents","thisRef","eventManager","undefined","events","panmove","evt","panend","pancancel","watch","off","useDraggableControl","useState","useMapControl","useEffect","Boolean"],"sources":["../../../src/components/draggable-control.js"],"sourcesContent":["// Copyright (c) 2015 Uber Technologies, Inc.\n\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\nimport * as PropTypes from 'prop-types';\nimport {useState, useEffect} from 'react';\nimport useMapControl, {mapControlDefaultProps, mapControlPropTypes} from './use-map-control';\n\nexport const draggableControlPropTypes = Object.assign({}, mapControlPropTypes, {\n  draggable: PropTypes.bool,\n  onDrag: PropTypes.func,\n  onDragEnd: PropTypes.func,\n  onDragStart: PropTypes.func,\n  // Offset from the left\n  offsetLeft: PropTypes.number,\n  // Offset from the top\n  offsetTop: PropTypes.number\n});\n\nexport const draggableControlDefaultProps = Object.assign({}, mapControlDefaultProps, {\n  draggable: false,\n  offsetLeft: 0,\n  offsetTop: 0\n});\n\nfunction getDragEventPosition(event) {\n  const {\n    offsetCenter: {x, y}\n  } = event;\n  return [x, y];\n}\n\n/**\n * Returns offset of top-left of marker from drag start event\n * (used for positioning marker relative to next mouse coordinates)\n */\nfunction getDragEventOffset(event, container) {\n  const {\n    center: {x, y}\n  } = event;\n  if (container) {\n    const rect = container.getBoundingClientRect();\n    return [rect.left - x, rect.top - y];\n  }\n  return null;\n}\n\nfunction getDragLngLat(dragPos, dragOffset, props, context) {\n  const x = dragPos[0] + dragOffset[0] - props.offsetLeft;\n  const y = dragPos[1] + dragOffset[1] - props.offsetTop;\n  // Unproject x/y value while respecting offset coordinates\n  return context.viewport.unproject([x, y]);\n}\n\nfunction onDragStart(event, {props, callbacks, state, context, containerRef}) {\n  const {draggable} = props;\n  if (!draggable) {\n    return;\n  }\n  event.stopPropagation();\n\n  const dragPos = getDragEventPosition(event);\n  const dragOffset = getDragEventOffset(event, containerRef.current);\n  state.setDragPos(dragPos);\n  state.setDragOffset(dragOffset);\n\n  if (callbacks.onDragStart && dragOffset) {\n    const callbackEvent = Object.assign({}, event);\n    callbackEvent.lngLat = getDragLngLat(dragPos, dragOffset, props, context);\n    callbacks.onDragStart(callbackEvent);\n  }\n}\n\nfunction onDrag(event, {props, callbacks, state, context}) {\n  event.stopPropagation();\n\n  const dragPos = getDragEventPosition(event);\n  state.setDragPos(dragPos);\n\n  const {dragOffset} = state;\n  if (callbacks.onDrag && dragOffset) {\n    const callbackEvent = Object.assign({}, event);\n    callbackEvent.lngLat = getDragLngLat(dragPos, dragOffset, props, context);\n    callbacks.onDrag(callbackEvent);\n  }\n}\n\nfunction onDragEnd(event, {props, callbacks, state, context}) {\n  event.stopPropagation();\n\n  const {dragPos, dragOffset} = state;\n  state.setDragPos(null);\n  state.setDragOffset(null);\n\n  if (callbacks.onDragEnd && dragPos && dragOffset) {\n    const callbackEvent = Object.assign({}, event);\n    callbackEvent.lngLat = getDragLngLat(dragPos, dragOffset, props, context);\n    callbacks.onDragEnd(callbackEvent);\n  }\n}\n\nfunction onDragCancel(event, {state}) {\n  event.stopPropagation();\n\n  state.setDragPos(null);\n  state.setDragOffset(null);\n}\n\nfunction registerEvents(thisRef) {\n  const {eventManager} = thisRef.context;\n  if (!eventManager || !thisRef.state.dragPos) {\n    return undefined;\n  }\n\n  // panstart is already attached by parent class BaseControl,\n  // here we just add listeners for subsequent drag events\n  const events = {\n    panmove: evt => onDrag(evt, thisRef),\n    panend: evt => onDragEnd(evt, thisRef),\n    pancancel: evt => onDragCancel(evt, thisRef)\n  };\n  eventManager.watch(events);\n\n  // Clean up\n  return () => {\n    eventManager.off(events);\n  };\n}\n\nexport default function useDraggableControl(props) {\n  const [dragPos, setDragPos] = useState(null);\n  const [dragOffset, setDragOffset] = useState(null);\n\n  const thisRef = useMapControl({\n    ...props,\n    onDragStart\n  });\n\n  thisRef.callbacks = props;\n  thisRef.state.dragPos = dragPos;\n  thisRef.state.setDragPos = setDragPos;\n  thisRef.state.dragOffset = dragOffset;\n  thisRef.state.setDragOffset = setDragOffset;\n\n  useEffect(() => registerEvents(thisRef), [thisRef.context.eventManager, Boolean(dragPos)]);\n\n  return thisRef;\n}\n"],"mappings":"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"}