{"version":3,"file":"style-utils.js","names":["refProps","normalizeStyle","style","toJS","layerIndex","layers","layer","id","map","layerRef","ref","normalizedLayer","interactive","propName"],"sources":["../../../src/utils/style-utils.js"],"sourcesContent":["const refProps = ['type', 'source', 'source-layer', 'minzoom', 'maxzoom', 'filter', 'layout'];\n\n// Prepare a map style object for diffing\n// If immutable - convert to plain object\n// Work around some issues in the styles that would fail Mapbox's diffing\nexport function normalizeStyle(style) {\n  if (!style) {\n    return null;\n  }\n  if (typeof style === 'string') {\n    return style;\n  }\n  if (style.toJS) {\n    style = style.toJS();\n  }\n  const layerIndex = {};\n\n  for (const layer of style.layers) {\n    layerIndex[layer.id] = layer;\n  }\n\n  const layers = style.layers.map(layer => {\n    const layerRef = layerIndex[layer.ref];\n    let normalizedLayer = null;\n\n    if ('interactive' in layer) {\n      normalizedLayer = {...layer};\n      // Breaks style diffing :(\n      delete normalizedLayer.interactive;\n    }\n\n    // Style diffing doesn't work with refs so expand them out manually before diffing.\n    if (layerRef) {\n      normalizedLayer = normalizedLayer || {...layer};\n      delete normalizedLayer.ref;\n      // https://github.com/mapbox/mapbox-gl-js/blob/master/src/style-spec/deref.js\n      for (const propName of refProps) {\n        if (propName in layerRef) {\n          normalizedLayer[propName] = layerRef[propName];\n        }\n      }\n    }\n\n    return normalizedLayer || layer;\n  });\n\n  // Do not mutate the style object provided by the user\n  return {...style, layers};\n}\n"],"mappings":";;;;;;AAAA,IAAMA,QAAQ,GAAG,CAAC,MAAM,EAAE,QAAQ,EAAE,cAAc,EAAE,SAAS,EAAE,SAAS,EAAE,QAAQ,EAAE,QAAQ,CAAC;AAK7F,OAAO,SAASC,cAAc,CAACC,KAAK,EAAE;EACpC,IAAI,CAACA,KAAK,EAAE;IACV,OAAO,IAAI;EACb;EACA,IAAI,OAAOA,KAAK,KAAK,QAAQ,EAAE;IAC7B,OAAOA,KAAK;EACd;EACA,IAAIA,KAAK,CAACC,IAAI,EAAE;IACdD,KAAK,GAAGA,KAAK,CAACC,IAAI,EAAE;EACtB;EACA,IAAMC,UAAU,GAAG,CAAC,CAAC;EAAC,2CAEFF,KAAK,CAACG,MAAM;IAAA;EAAA;IAAhC,oDAAkC;MAAA,IAAvBC,KAAK;MACdF,UAAU,CAACE,KAAK,CAACC,EAAE,CAAC,GAAGD,KAAK;IAC9B;EAAC;IAAA;EAAA;IAAA;EAAA;EAED,IAAMD,MAAM,GAAGH,KAAK,CAACG,MAAM,CAACG,GAAG,CAAC,UAAAF,KAAK,EAAI;IACvC,IAAMG,QAAQ,GAAGL,UAAU,CAACE,KAAK,CAACI,GAAG,CAAC;IACtC,IAAIC,eAAe,GAAG,IAAI;IAE1B,IAAI,aAAa,IAAIL,KAAK,EAAE;MAC1BK,eAAe,qBAAOL,KAAK,CAAC;MAE5B,OAAOK,eAAe,CAACC,WAAW;IACpC;IAGA,IAAIH,QAAQ,EAAE;MACZE,eAAe,GAAGA,eAAe,sBAAQL,KAAK,CAAC;MAC/C,OAAOK,eAAe,CAACD,GAAG;MAAC,4CAEJV,QAAQ;QAAA;MAAA;QAA/B,uDAAiC;UAAA,IAAtBa,QAAQ;UACjB,IAAIA,QAAQ,IAAIJ,QAAQ,EAAE;YACxBE,eAAe,CAACE,QAAQ,CAAC,GAAGJ,QAAQ,CAACI,QAAQ,CAAC;UAChD;QACF;MAAC;QAAA;MAAA;QAAA;MAAA;IACH;IAEA,OAAOF,eAAe,IAAIL,KAAK;EACjC,CAAC,CAAC;EAGF,uCAAWJ,KAAK;IAAEG,MAAM,EAANA;EAAM;AAC1B"}