{"version":3,"file":"goong.js","names":["PropTypes","document","normalizeStyle","noop","defaultOnError","event","console","error","propTypes","container","object","gl","goongApiAccessToken","string","goongApiUrl","attributionControl","bool","preserveDrawingBuffer","reuseMaps","transformRequest","func","mapOptions","mapStyle","oneOfType","preventStyleDiffing","visible","asyncRender","onLoad","onError","width","number","height","viewState","longitude","latitude","zoom","bearing","pitch","altitude","defaultProps","body","getAccessToken","accessToken","window","location","match","search","process","env","GoongAccessToken","REACT_APP_GOONG_ACCESS_TOKEN","checkPropTypes","props","component","debug","Goong","type","target","_map","mapboxgl","Error","initialized","_checkStyleSheet","version","_initialize","_destroy","_update","map","style","_frame","cancel","_render","savedMap","oldContainer","getContainer","newContainer","classList","add","childNodes","length","appendChild","_container","setStyle","diff","isStyleLoaded","_fireLoadEvent","once","_reuse","getContext","HTMLCanvasElement","prototype","center","maxZoom","interactive","trackResize","Map","Object","assign","on","off","remove","baseApiUrl","_create","defineProperty","configurable","get","canvas","getCanvas","outline","_updateMapViewport","_updateMapSize","oldProps","newProps","viewportChanged","sizeChanged","_updateMapStyle","redraw","styleChanged","resize","oldViewState","_getViewState","newViewState","jumpTo","_viewStateToMapboxProps","transform","goongVersion","testElement","createElement","className","display","isCssLoaded","getComputedStyle","position","link","setAttribute","head"],"sources":["../../../src/goong/goong.js"],"sourcesContent":["// @flow\n// Copyright (c) 2015 Uber Technologies, Inc.\n\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n/* global window, process, HTMLCanvasElement */\nimport * as PropTypes from 'prop-types';\nimport {document} from '../utils/globals';\nimport {normalizeStyle} from '../utils/style-utils';\n\nfunction noop() {}\n\nfunction defaultOnError(event) {\n  if (event) {\n    console.error(event.error); // eslint-disable-line\n  }\n}\n\nconst propTypes = {\n  // Creation parameters\n  container: PropTypes.object /** The container to have the map. */,\n  gl: PropTypes.object /** External WebGLContext to use */,\n\n  goongApiAccessToken: PropTypes.string /** Goong API access token for Goong tiles/styles. */,\n  goongApiUrl: PropTypes.string,\n  attributionControl: PropTypes.bool /** Show attribution control or not. */,\n  preserveDrawingBuffer: PropTypes.bool /** Useful when you want to export the canvas as a PNG. */,\n  reuseMaps: PropTypes.bool,\n  transformRequest: PropTypes.func /** The transformRequest callback for the map */,\n  mapOptions: PropTypes.object /** Extra options to pass to Goong constructor. See #545. **/,\n  mapStyle: PropTypes.oneOfType([\n    PropTypes.string,\n    PropTypes.object\n  ]) /** The Goong style. A string url to a Goong style */,\n  preventStyleDiffing:\n    PropTypes.bool /** There are known issues with style diffing. As stopgap, add option to prevent style diffing. */,\n\n  visible: PropTypes.bool /** Whether the map is visible */,\n  asyncRender: PropTypes.bool /** Whether goong map should manage its own render cycle */,\n\n  onLoad: PropTypes.func /** The onLoad callback for the map */,\n  onError: PropTypes.func /** The onError callback for the map */,\n\n  // Map view state\n  width: PropTypes.number /** The width of the map. */,\n  height: PropTypes.number /** The height of the map. */,\n\n  viewState: PropTypes.object /** object containing lng/lat/zoom/bearing/pitch */,\n\n  longitude: PropTypes.number /** The longitude of the center of the map. */,\n  latitude: PropTypes.number /** The latitude of the center of the map. */,\n  zoom: PropTypes.number /** The tile zoom level of the map. */,\n  bearing: PropTypes.number /** Specify the bearing of the viewport */,\n  pitch: PropTypes.number /** Specify the pitch of the viewport */,\n  // Note: Non-public API, see https://github.com/mapbox/mapbox-gl-js/issues/1137\n  altitude: PropTypes.number /** Altitude of the viewport camera. Default 1.5 \"screen heights\" */\n};\n\nconst defaultProps = {\n  container: document.body,\n  goongApiAccessToken: getAccessToken(),\n  goongApiUrl: 'https://tiles.goong.io',\n  preserveDrawingBuffer: false,\n  attributionControl: true,\n  reuseMaps: false,\n  mapOptions: {},\n  mapStyle: 'https://tiles.goong.io/assets/goong_map_web.json',\n  preventStyleDiffing: false,\n\n  visible: true,\n  asyncRender: false,\n\n  onLoad: noop,\n  onError: defaultOnError,\n\n  width: 0,\n  height: 0,\n  longitude: 0,\n  latitude: 0,\n  zoom: 0,\n  bearing: 0,\n  pitch: 0,\n  altitude: 1.5\n};\n\n// Try to get access token from URL, env, local storage or config\nexport function getAccessToken() {\n  let accessToken = null;\n\n  if (typeof window !== 'undefined' && window.location) {\n    const match = window.location.search.match(/api_key=([^&\\/]*)/);\n    accessToken = match && match[1];\n  }\n\n  if (!accessToken && typeof process !== 'undefined') {\n    // Note: This depends on bundler plugins (e.g. webpack) importing environment correctly\n    accessToken =\n      accessToken || process.env.GoongAccessToken || process.env.REACT_APP_GOONG_ACCESS_TOKEN; // eslint-disable-line\n  }\n\n  // Prevents goong from throwing\n  return accessToken || 'no-token';\n}\n\n// Helper function to merge defaultProps and check prop types\nfunction checkPropTypes(props, component = 'component') {\n  // TODO - check for production (unless done by prop types package?)\n  if (props.debug) {\n    PropTypes.checkPropTypes(propTypes, props, 'prop', component);\n  }\n}\n\n// A small wrapper class for goong-js\n// - Provides a prop style interface (that can be trivially used by a React wrapper)\n// - Makes sure goong doesn't crash under Node\n// - Handles map reuse (to work around Goong resource leak issues)\n// - Provides support for specifying tokens during development\n\nexport default class Goong {\n  static initialized = false;\n  static propTypes = propTypes;\n  static defaultProps = defaultProps;\n  static savedMap = null;\n\n  constructor(props) {\n    if (!props.mapboxgl) {\n      throw new Error('Goong JS not available');\n    }\n\n    this.mapboxgl = props.mapboxgl;\n\n    if (!Goong.initialized) {\n      Goong.initialized = true;\n\n      // Version detection using babel plugin\n      // const VERSION = typeof __VERSION__ !== 'undefined' ? __VERSION__ : 'untranspiled source';\n      // TODO - expose version for debug\n\n      this._checkStyleSheet(this.mapboxgl.version);\n    }\n\n    this._initialize(props);\n  }\n\n  props = defaultProps;\n  width = 0;\n  height = 0;\n\n  finalize() {\n    this._destroy();\n    return this;\n  }\n\n  setProps(props) {\n    this._update(this.props, props);\n    return this;\n  }\n\n  // Force redraw the map now. Typically resize() and jumpTo() is reflected in the next\n  // render cycle, which is managed by Goong's animation loop.\n  // This removes the synchronization issue caused by requestAnimationFrame.\n  redraw() {\n    const map = this._map;\n    // map._render will throw error if style does not exist\n    // https://github.com/mapbox/mapbox-gl-js/blob/fb9fc316da14e99ff4368f3e4faa3888fb43c513\n    //   /src/ui/map.js#L1834\n    if (map.style) {\n      // cancel the scheduled update\n      if (map._frame) {\n        map._frame.cancel();\n        map._frame = null;\n      }\n      // the order is important - render() may schedule another update\n      map._render();\n    }\n  }\n\n  // External apps can access map this way\n  getMap() {\n    return this._map;\n  }\n\n  // PRIVATE API\n  _fireLoadEvent = () => {\n    // @ts-ignore\n    this.props.onLoad({\n      type: 'load',\n      target: this._map\n    });\n  };\n\n  _reuse(props) {\n    this._map = Goong.savedMap;\n    // When reusing the saved map, we need to reparent the map(canvas) and other child nodes\n    // intoto the new container from the props.\n    // Step1: reparenting child nodes from old container to new container, do not execute if same element, otherwise will loop and crash.\n    const oldContainer = this._map.getContainer();\n    const newContainer = props.container;\n    newContainer.classList.add('mapboxgl-map');\n\n    if (oldContainer !== newContainer) {\n      while (oldContainer.childNodes.length > 0) {\n        newContainer.appendChild(oldContainer.childNodes[0]);\n      }\n    }\n\n    // Step2: replace the internal container with new container from the react component\n    this._map._container = newContainer;\n    Goong.savedMap = null;\n\n    // Step3: update style and call onload again\n    if (props.mapStyle) {\n      this._map.setStyle(normalizeStyle(props.mapStyle), {\n        // From the user's perspective, there's no \"diffing\" on initialization\n        // We always rebuild the style from scratch when creating a new Goong instance\n        diff: false\n      });\n    }\n\n    // call onload event handler after style fully loaded when style needs update\n    if (this._map.isStyleLoaded()) {\n      this._fireLoadEvent();\n    } else {\n      this._map.once('styledata', this._fireLoadEvent);\n    }\n  }\n\n  _create(props) {\n    // Reuse a saved map, if available\n    if (props.reuseMaps && Goong.savedMap) {\n      this._reuse(props);\n    } else {\n      if (props.gl) {\n        const getContext = HTMLCanvasElement.prototype.getContext;\n        // Hijack canvas.getContext to return our own WebGLContext\n        // This will be called inside the mapboxgl.Map constructor\n        HTMLCanvasElement.prototype.getContext = () => {\n          // Unhijack immediately\n          HTMLCanvasElement.prototype.getContext = getContext;\n          return props.gl;\n        };\n      }\n\n      const mapOptions = {\n        container: props.container,\n        center: [0, 0],\n        zoom: 8,\n        pitch: 0,\n        bearing: 0,\n        maxZoom: 24,\n        style: normalizeStyle(props.mapStyle),\n        interactive: false,\n        trackResize: false,\n        attributionControl: props.attributionControl,\n        preserveDrawingBuffer: props.preserveDrawingBuffer\n      };\n      // We don't want to pass a null or no-op transformRequest function.\n      if (props.transformRequest) {\n        mapOptions.transformRequest = props.transformRequest;\n      }\n      this._map = new this.mapboxgl.Map(Object.assign({}, mapOptions, props.mapOptions));\n\n      // Attach optional onLoad function\n      this._map.once('load', props.onLoad);\n      this._map.on('error', props.onError);\n    }\n\n    return this;\n  }\n\n  _destroy() {\n    if (!this._map) {\n      return;\n    }\n\n    if (this.props.reuseMaps && !Goong.savedMap) {\n      Goong.savedMap = this._map;\n\n      // deregister the goong event listeners\n      this._map.off('load', this.props.onLoad);\n      this._map.off('error', this.props.onError);\n      this._map.off('styledata', this._fireLoadEvent);\n    } else {\n      this._map.remove();\n    }\n\n    this._map = null;\n  }\n\n  _initialize(props) {\n    props = Object.assign({}, defaultProps, props);\n    checkPropTypes(props, 'Goong');\n\n    // Creation only props\n    this.mapboxgl.accessToken = props.goongApiAccessToken || defaultProps.goongApiAccessToken;\n    this.mapboxgl.baseApiUrl = props.goongApiUrl;\n\n    this._create(props);\n\n    // Hijack dimension properties\n    // This eliminates the timing issue between calling resize() and DOM update\n    /* eslint-disable accessor-pairs */\n    const {container} = props;\n    Object.defineProperty(container, 'offsetWidth', {\n      configurable: true,\n      get: () => this.width\n    });\n    Object.defineProperty(container, 'clientWidth', {\n      configurable: true,\n      get: () => this.width\n    });\n    Object.defineProperty(container, 'offsetHeight', {\n      configurable: true,\n      get: () => this.height\n    });\n    Object.defineProperty(container, 'clientHeight', {\n      configurable: true,\n      get: () => this.height\n    });\n\n    // Disable outline style\n    const canvas = this._map.getCanvas();\n    if (canvas) {\n      canvas.style.outline = 'none';\n    }\n\n    this._updateMapViewport({}, props);\n    this._updateMapSize({}, props);\n\n    this.props = props;\n  }\n\n  _update(oldProps, newProps) {\n    if (!this._map) {\n      return;\n    }\n\n    newProps = Object.assign({}, this.props, newProps);\n    checkPropTypes(newProps, 'Goong');\n\n    const viewportChanged = this._updateMapViewport(oldProps, newProps);\n    const sizeChanged = this._updateMapSize(oldProps, newProps);\n    this._updateMapStyle(oldProps, newProps);\n\n    if (!newProps.asyncRender && (viewportChanged || sizeChanged)) {\n      this.redraw();\n    }\n\n    this.props = newProps;\n  }\n\n  _updateMapStyle(oldProps, newProps) {\n    const styleChanged = oldProps.mapStyle !== newProps.mapStyle;\n    if (styleChanged) {\n      this._map.setStyle(normalizeStyle(newProps.mapStyle), {\n        diff: !newProps.preventStyleDiffing\n      });\n    }\n  }\n\n  // Note: needs to be called after render (e.g. in componentDidUpdate)\n  _updateMapSize(oldProps, newProps) {\n    const sizeChanged = oldProps.width !== newProps.width || oldProps.height !== newProps.height;\n    if (sizeChanged) {\n      this.width = newProps.width;\n      this.height = newProps.height;\n      this._map.resize();\n    }\n    return sizeChanged;\n  }\n\n  _updateMapViewport(oldProps, newProps) {\n    const oldViewState = this._getViewState(oldProps);\n    const newViewState = this._getViewState(newProps);\n\n    const viewportChanged =\n      newViewState.latitude !== oldViewState.latitude ||\n      newViewState.longitude !== oldViewState.longitude ||\n      newViewState.zoom !== oldViewState.zoom ||\n      newViewState.pitch !== oldViewState.pitch ||\n      newViewState.bearing !== oldViewState.bearing ||\n      newViewState.altitude !== oldViewState.altitude;\n\n    if (viewportChanged) {\n      this._map.jumpTo(this._viewStateToMapboxProps(newViewState));\n\n      // TODO - jumpTo doesn't handle altitude\n      if (newViewState.altitude !== oldViewState.altitude) {\n        this._map.transform.altitude = newViewState.altitude;\n      }\n    }\n    return viewportChanged;\n  }\n\n  _getViewState(props) {\n    const {\n      longitude,\n      latitude,\n      zoom,\n      pitch = 0,\n      bearing = 0,\n      altitude = 1.5\n    } = props.viewState || props;\n    return {longitude, latitude, zoom, pitch, bearing, altitude};\n  }\n\n  _checkStyleSheet(goongVersion = '1.0.6') {\n    if (typeof document === 'undefined') {\n      return;\n    }\n\n    // check goong styles\n    try {\n      const testElement = document.createElement('div');\n      testElement.className = 'mapboxgl-map';\n      testElement.style.display = 'none';\n      document.body.appendChild(testElement);\n      const isCssLoaded = window.getComputedStyle(testElement).position !== 'static';\n\n      if (!isCssLoaded) {\n        // attempt to insert goong stylesheet\n        const link = document.createElement('link');\n        link.setAttribute('rel', 'stylesheet');\n        link.setAttribute('type', 'text/css');\n        link.setAttribute(\n          'href',\n          `https://cdn.jsdelivr.net/npm/@goongmaps/goong-js@${goongVersion}/dist/goong-js.css`\n        );\n        document.head.appendChild(link);\n      }\n    } catch (error) {\n      // do nothing\n    }\n  }\n\n  _viewStateToMapboxProps(viewState) {\n    return {\n      center: [viewState.longitude, viewState.latitude],\n      zoom: viewState.zoom,\n      bearing: viewState.bearing,\n      pitch: viewState.pitch\n    };\n  }\n}\n"],"mappings":"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"}